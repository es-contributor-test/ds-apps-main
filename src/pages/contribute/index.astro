---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Breadcrumbs from '../../../packages/shared/src/components/Breadcrumbs.astro'
import Contributors from '@/components/Contributors.astro'
import { Icon } from 'astro-icon/components'
import { getLiveProjects, getProjectsByStatus, STATUS_CONFIG } from '../../../packages/shared/src/lib/projects'
import { getAllProjects } from '../../../packages/shared/src/data/projectLoader'

const allProjects = getAllProjects()
const liveProjects = getLiveProjects(allProjects)
const inProgressProjects = getProjectsByStatus(allProjects, 'in-progress')
---

<BaseLayout meta={{ title: 'Build With Me' }}>
  <div class="flex w-full flex-col">
    <Breadcrumbs currentLabel="Contribute" />

    <!-- Hero -->
    <section class="mt-6 space-y-4">
      <h1 class="text-2xl font-bold text-foreground sm:text-3xl">Build With Me</h1>
      <p class="text-base text-muted-foreground">
        I'm building data science tools in public. Each project is a standalone web app with real analytics. Contribute to existing projects or build your own.
      </p>
    </section>

    <!-- Contributors -->
    <section class="mt-10 border border-border bg-primary-foreground p-6">
      <h2 class="text-xl font-bold text-foreground mb-4">Active Contributors</h2>
      <Contributors days={90} maxDisplay={8} />
    </section>

    <!-- Current Projects -->
    <section class="mt-6 border border-border bg-primary-foreground p-6">
      <h2 class="text-xl font-bold text-foreground mb-2">Current Projects</h2>
      <p class="text-sm text-muted-foreground mb-4">
        Each <code class="bg-muted px-1.5 py-0.5 rounded text-sm">/packages/*</code> folder is an independent web app with its own analytics pipeline.
      </p>
      
      <div class="space-y-3">
        {liveProjects.map((project) => (
          <div class="flex items-center justify-between border border-border bg-background p-4">
            <div>
              <div class="flex items-center gap-2">
                <span class={`w-2 h-2 rounded-full ${STATUS_CONFIG[project.status].dotColor}`}></span>
                <span class="font-medium">{project.name}</span>
              </div>
              <p class="text-sm text-muted-foreground mt-1">{project.shortDescription}</p>
            </div>
            <div class="flex gap-4 text-sm">
              {project.url && project.url !== '#' && (
                <a href={project.url} class="text-foreground underline">Try it â†’</a>
              )}
              {project.hubUrl && (
                <a href={project.hubUrl} class="text-muted-foreground underline hover:text-foreground">Docs</a>
              )}
            </div>
          </div>
        ))}
        {inProgressProjects.map((project) => (
          <div class="flex items-center justify-between border border-border bg-background p-4 opacity-60">
            <div>
              <div class="flex items-center gap-2">
                <span class={`w-2 h-2 rounded-full ${STATUS_CONFIG[project.status].dotColor}`}></span>
                <span class="font-medium">{project.name}</span>
                <span class="text-sm text-muted-foreground">({STATUS_CONFIG[project.status].label})</span>
              </div>
              <p class="text-sm text-muted-foreground mt-1">{project.shortDescription}</p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- How to Contribute -->
    <section class="mt-6 border border-border bg-primary-foreground p-6">
      <h2 class="text-xl font-bold text-foreground mb-4">How to Contribute</h2>
      
      <!-- Detailed Guide CTA -->
      <div class="mb-6 p-4 border-2 border-dashed border-amber-400 dark:border-amber-600 bg-amber-50 dark:bg-amber-950/30">
        <p class="font-medium text-amber-800 dark:text-amber-200">
          ðŸš€ New to contributing? <a href="/contribute/guide" class="underline hover:text-amber-900 dark:hover:text-amber-100 font-bold">Read the step-by-step guide â†’</a>
        </p>
        <p class="text-sm text-amber-700 dark:text-amber-300 mt-1">
          Prerequisites, setup commands, project structure, and tips for using AIâ€”everything you need.
        </p>
      </div>
      
      <div class="space-y-6">
        <div>
          <h3 class="text-base font-semibold text-foreground mb-3">Option 1: Fix or Enhance Existing Web Apps</h3>
          <ol class="space-y-2 text-base text-muted-foreground">
            <li><strong class="text-foreground">Browse</strong> <a href="https://github.com/eeshansrivastava89/ds-apps-main/issues?q=is%3Aissue+is%3Aopen" class="underline hover:text-foreground">open issues</a></li>
            <li><strong class="text-foreground">Claim</strong> by commenting on an issue</li>
            <li><strong class="text-foreground">Branch</strong> as <code class="bg-muted px-1.5 py-0.5 rounded text-sm">feature/your-handle-topic</code></li>
            <li><strong class="text-foreground">Ship</strong> a PR with summary + screenshots</li>
          </ol>
          <p class="mt-3 text-base">
            <a href="https://github.com/eeshansrivastava89/ds-apps-main" class="text-muted-foreground underline hover:text-foreground">Source Code</a>
          </p>
        </div>

        <hr class="border-border" />

        <div>
          <h3 class="text-base font-semibold text-foreground mb-3">Option 2: Build a New Web App</h3>
          <ol class="space-y-2 text-base text-muted-foreground">
            <li><strong class="text-foreground">Propose</strong> via <a href="https://github.com/eeshansrivastava89/ds-apps-main/discussions/new?category=new-data-science-web-app-proposals" class="underline hover:text-foreground">GitHub Discussion</a></li>
            <li><strong class="text-foreground">Get approved</strong> â€” we'll discuss scope and infrastructure</li>
            <li><strong class="text-foreground">Build</strong> in <code class="bg-muted px-1.5 py-0.5 rounded text-sm">/packages/your-app</code></li>
            <li><strong class="text-foreground">Analyze</strong> â€” add a notebook, we'll auto-render it</li>
          </ol>
          <p class="mt-3 text-base text-muted-foreground">
            You get: PostHog analytics (shared), Supabase schema template, auto-running notebooks, your name on the project.
          </p>
        </div>
      </div>
    </section>

    <!-- Advice -->
    <section class="mt-6 border border-border bg-primary-foreground p-6">
      <h2 class="text-xl font-bold text-foreground mb-4">My Recommendations on Workflow</h2>
      <ul class="space-y-2 text-base text-muted-foreground">
        <li><strong class="text-foreground">Use AI comprehensively</strong> â€” explain codebase context, review approach, iterate</li>
        <li><strong class="text-foreground">Follow the workflow</strong> â€” <a href="/writing/how-i-ai" class="underline hover:text-foreground">How I AI</a> breaks down my approach</li>
        <li><strong class="text-foreground">Test before PR</strong> â€” <code class="bg-muted px-1.5 py-0.5 rounded text-sm">pnpm dev</code> â†’ <code class="bg-muted px-1.5 py-0.5 rounded text-sm">pnpm build</code> â†’ ship</li>
      </ul>
    </section>

    <!-- Stack -->
    <section class="mt-6 border border-border bg-primary-foreground p-6">
      <h2 class="text-xl font-bold text-foreground mb-4">Stack</h2>
      <div class="space-y-4">
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Frontend</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://astro.build/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:astro" class="h-4 w-4" /> Astro
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://react.dev/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:react" class="h-4 w-4" /> React
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://tailwindcss.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:tailwindcss" class="h-4 w-4" /> Tailwind
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Backend</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://supabase.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:supabase" class="h-4 w-4" /> Supabase
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://posthog.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:posthog" class="h-4 w-4" /> PostHog
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Infrastructure</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://fly.io/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:flydotio" class="h-4 w-4" /> Fly.io
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:githubactions" class="h-4 w-4" /> GitHub Actions
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://cloudflare.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:cloudflare" class="h-4 w-4" /> Cloudflare
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://papermill.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:jupyter" class="h-4 w-4" /> Papermill
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-medium text-muted-foreground mb-2">Data Science</h3>
          <div class="flex flex-wrap items-center gap-x-2 text-base">
            <a href="https://python.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:python" class="h-4 w-4" /> Python
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://pandas.pydata.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:pandas" class="h-4 w-4" /> Pandas
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:plotly" class="h-4 w-4" /> Plotly
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://www.statsmodels.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:scipy" class="h-4 w-4" /> Statsmodels
            </a>
            <span class="text-muted-foreground">|</span>
            <a href="https://seaborn.pydata.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 text-foreground underline">
              <Icon name="simple-icons:python" class="h-4 w-4" /> Seaborn
            </a>
          </div>
        </div>
      </div>
    </section>

  </div>
</BaseLayout>
