---
import PageLayout from '../../layouts/BaseLayout.astro'
---

<PageLayout meta={{ title: 'A/B Test Simulator' }}>
	<div class="w-full space-y-8">
		<!-- Header -->
		<div class="space-y-2">
			<h1 class="text-3xl font-bold">A/B Test Simulator</h1>
			<p class="text-base text-muted-foreground">Interactive word search puzzle demonstrating A/B testing with PostHog experiments and real-time analytics</p>
		</div>

		<!-- Challenge Info -->
		<div id="challenge-section" class="rounded-lg border bg-card p-4">
			<h3 class="mb-3 font-semibold">Your Challenge</h3>
			<div class="grid grid-cols-2 gap-3 md:grid-cols-4">
				<div class="text-sm">
					<div class="text-xs text-muted-foreground">Variant</div>
					<div id="user-variant" class="font-mono font-bold">Loading...</div>
				</div>
				<div class="text-sm">
					<div class="text-xs text-muted-foreground">Username</div>
					<div id="user-username" class="truncate font-mono">Loading...</div>
				</div>
				<div class="text-sm">
					<div class="text-xs text-muted-foreground">Difficulty</div>
					<div id="difficulty-display" class="font-mono">Loading...</div>
				</div>
				<div class="text-sm">
					<div class="text-xs text-muted-foreground">Find Words</div>
					<div id="target-word-count" class="font-mono font-bold">0</div>
				</div>
			</div>
		</div>

		<!-- Puzzle Section -->
		<div id="puzzle-section" class="space-y-4 rounded-lg border bg-card p-4">
			<h3 class="font-semibold">Find the Words</h3>
			
			<!-- Three-column layout: Grid (1/3) + Controls (1/3) + Stats (1/3) -->
			<div class="grid gap-6" style="grid-template-columns: 1fr 1fr 1fr;">
				<!-- LEFT: Letter Grid (1/3) -->
				<div>
					<div id="letter-grid" class="grid gap-2" style="grid-template-columns: repeat(auto-fit, minmax(44px, 1fr));"></div>
				</div>

				<!-- CENTER: Controls & Info (1/3) -->
				<div class="space-y-4">
					<!-- Timer + Try Again Button (always visible, changes state) -->
					<div class="flex flex-col gap-1">
						<!-- Action Button (Start / Try Again / Reset) -->
						<div id="controls" class="flex flex-row gap-2">
							<button id="start-button" class="flex-1 rounded-lg bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors">Start</button>
							<button id="reset-button" class="hidden flex-1 rounded-lg bg-secondary px-3 py-2 text-sm font-medium text-secondary-foreground hover:bg-secondary/80 transition-colors">Stop</button>
							<button id="try-again-inline-button" class="hidden flex-1 rounded-lg bg-orange-600 px-3 py-2 text-sm font-medium text-white hover:bg-orange-700 transition-colors">Try Again</button>
						</div>
						
						<!-- Timer -->
						<div class="grid grid-cols-3 items-center rounded-lg bg-muted p-4">
							<div class="text-xs text-muted-foreground">Time</div>
							<div id="timer" class="font-mono text-2xl font-bold col-span-2">00:60:00</div>
						</div>
					</div>					<!-- Input Box (hidden until started) -->
					<div id="input-section" class="hidden space-y-2">
						<label for="word-input" class="text-xs font-medium text-muted-foreground">Enter Word</label>
						<input type="text" id="word-input" placeholder="Type a word..." autocomplete="off" class="w-full rounded-lg border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
					</div>

					<!-- Found Words -->
					<div id="found-words" class="rounded-lg bg-muted p-3">
						<div class="text-xs text-muted-foreground mb-2">Found Words</div>
						<div id="found-words-list" class="font-mono text-sm">(none yet)</div>
					</div>
				</div>

				<!-- RIGHT: Leaderboard (1/3) -->
				<div id="leaderboard-display" class="rounded-lg border bg-muted p-3">
					<h4 class="text-xs font-semibold text-muted-foreground uppercase tracking-wide">üèÜ Top Players</h4>
					<div id="leaderboard-list" class="space-y-1.5 mt-2 text-xs"></div>
				</div>
			</div>
		</div>

		<!-- Result Card (modular, single-line design) -->
		<div id="result-card" class="hidden rounded-lg border border-green-200 bg-green-50 p-4 dark:border-green-900 dark:bg-green-950">
			<div class="flex flex-wrap items-center justify-between gap-4">
				<!-- Left: Status Badge -->
				<div class="inline-flex items-center gap-3 px-3 py-2 rounded-lg bg-white dark:bg-slate-950 border border-green-200 dark:border-green-900">
					<span class="text-xl">üéâ</span>
					<div>
						<p class="text-xs font-semibold text-muted-foreground uppercase tracking-wide">Challenge Complete</p>
						<p id="result-message" class="text-sm font-bold">üèÜ Personal Best!</p>
					</div>
				</div>

				<!-- Middle: Stats (Time & Guesses) -->
				<div class="flex items-center gap-4 px-3 py-2 rounded-lg bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-800">
					<div class="text-center">
						<p class="text-xs text-muted-foreground">Time</p>
						<p class="font-mono font-bold text-base"><span id="result-time">00:00:00</span></p>
					</div>
					<div style="width: 1px; height: 2rem; background-color: #e5e7eb; dark:background-color: #374151;"></div>
					<div class="text-center">
						<p class="text-xs text-muted-foreground">Guesses</p>
						<p class="font-mono font-bold text-base"><span id="result-guesses">0</span></p>
					</div>
				</div>

				<!-- Right: Actions -->
				<div class="flex gap-2">
					<button id="try-again-inline-button" class="hidden rounded-lg bg-orange-600 px-4 py-2 text-sm font-medium text-white hover:bg-orange-700 transition-colors">Try Again</button>
					<a href="#dashboard-section" class="rounded-lg bg-secondary px-4 py-2 text-sm font-medium text-secondary-foreground hover:bg-secondary/80 transition-colors">View Stats</a>
				</div>
			</div>
		</div>

		<!-- Dashboard -->
		<div id="dashboard-section" class="space-y-6 rounded-lg border bg-card p-4">
			<div class="flex items-center justify-between">
				<div>
					<h3 class="font-semibold">üìä Analytics Dashboard</h3>
					<p class="text-xs text-muted-foreground">Real-time A/B test results</p>
				</div>
				<div id="update-indicator" class="text-xs text-muted-foreground">
					<span id="last-updated">Loading...</span>
				</div>
			</div>

			<!-- Comparison Card (High Priority) -->
			<div class="rounded-xl border bg-card p-6">
				<div class="grid grid-cols-3 gap-6">
					<!-- Variant A -->
					<div class="space-y-3">
						<div class="flex items-center gap-2">
							<div class="flex items-center justify-center w-6 h-6 rounded bg-indigo-500 text-white text-xs font-bold">A</div>
							<div class="text-sm font-semibold">Control (3 words)</div>
						</div>
						<div>
							<div class="text-xs text-muted-foreground">Total Completions</div>
							<div id="variant-a-count" class="text-2xl font-bold">--</div>
						</div>
						<div>
							<div class="text-xs text-muted-foreground">Avg Completion Time</div>
							<div id="variant-a-time" class="font-mono text-2xl font-bold">--</div>
						</div>
					</div>

					<!-- Variant B -->
					<div class="space-y-3">
						<div class="flex items-center gap-2">
							<div class="flex items-center justify-center w-6 h-6 rounded bg-red-500 text-white text-xs font-bold">B</div>
							<div class="text-sm font-semibold">Variant (4 words)</div>
						</div>
						<div>
							<div class="text-xs text-muted-foreground">Total Completions</div>
							<div id="variant-b-count" class="text-2xl font-bold">--</div>
						</div>
						<div>
							<div class="text-xs text-muted-foreground">Avg Completion Time</div>
							<div id="variant-b-time" class="font-mono text-2xl font-bold">--</div>
						</div>
					</div>

					<!-- Comparison -->
					<div class="space-y-3">
						<div class="flex items-center gap-2">
							<div class="text-xl">‚öñÔ∏è</div>
							<div class="text-sm font-semibold">Comparison</div>
						</div>
						<div>
							<div class="text-xs text-muted-foreground">Time Difference</div>
							<div id="comparison-diff" class="font-mono text-2xl font-bold text-muted-foreground">--%</div>
						</div>
						<div id="comparison-status-box" class="hidden rounded-lg p-3">
							<div id="comparison-status" class="text-sm font-medium">--</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Funnel Chart (Moved up) -->
			<div class="rounded-lg border bg-card p-4">
				<div id="funnel-chart"></div>
			</div>

			<!-- Charts Grid: Avg Time + Distribution -->
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
				<!-- Avg Time Chart -->
				<div class="rounded-lg border bg-card p-4">
					<div id="avg-time-chart"></div>
				</div>

				<!-- Distribution Chart (Histogram) -->
				<div class="rounded-lg border bg-card p-4">
					<div id="distribution-chart"></div>
				</div>
			</div>

			<!-- Recent Completions Table -->
			<div class="rounded-lg border bg-card p-4">
				<h4 class="text-sm font-semibold mb-4">Recent Completions</h4>
				<div id="completions-table"></div>
			</div>
		</div>

		<script src="https://cdn.plot.ly/plotly-2.27.0.min.js" is:inline></script>
		<script src="/js/dashboard.js" is:inline></script>
	</div>
</PageLayout>

<script src="/js/ab-simulator.js" is:inline></script>