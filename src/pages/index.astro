---
import PageLayout from '../layouts/BaseLayout.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(
	path.join(process.cwd(), 'src/data/social-links.yaml'),
	'utf8'
)
const socialData = yaml.load(socialLinksYaml) as {
	socialLinks: Array<{ name: string; url: string; icon: string; label: string }>
}
const socialLinks = socialData.socialLinks

// Load projects
import { parseProjectsYaml, getLiveProjects, getProjectsByStatus } from '../../packages/shared/src/lib/projects'
import projectsYaml from '../../packages/shared/src/data/projects.yaml?raw'
import ProjectCard from '../../packages/shared/src/components/ProjectCard.astro'
import Timeline from '../../packages/shared/src/components/Timeline.astro'

const allProjects = parseProjectsYaml(projectsYaml)
const liveProjects = getLiveProjects(allProjects)
const inProgressProjects = getProjectsByStatus(allProjects, 'in-progress')
const upcomingProjects = getProjectsByStatus(allProjects, 'coming-soon')
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='w-full'>

		<!-- ============================================ -->
		<!-- HERO: Compact horizontal card                -->
		<!-- ============================================ -->
			<section class='border border-border bg-primary-foreground p-6 shadow-lg shadow-black/5'>
				<div class='flex flex-col items-center gap-6 sm:flex-row sm:items-start'>
					<!-- Profile Image -->
					<Image
						src={profile}
						alt='profile photo'
						class='h-28 w-28 shrink-0 rounded-full bg-[#FFBE98] p-1.5'
						loading='eager'
					/>

					<!-- Name + Tagline + Socials -->
					<div class='flex flex-col items-center gap-4 sm:items-start'>
						<div class='text-center sm:text-left'>
							<h1 class='text-2xl font-bold sm:text-3xl'>Eeshan Srivastava</h1>
							<p class='mt-1 text-lg text-muted-foreground'>
								Engineer × Data Scientist × Business Leader <span class='mx-1 text-border'>|</span> <span class='font-serif italic text-amber-700 dark:text-amber-400'>Building in Public</span>
							</p>
						</div>

						<!-- Social Links + Newsletter -->
						<div class='flex flex-wrap items-center gap-x-3 gap-y-3'>
							{
								socialLinks.map((link) => (
									<a
										href={link.url}
										target='_blank'
										class='flex h-9 w-9 items-center justify-center rounded-full border border-border bg-background transition-all hover:bg-input'
										aria-label={link.label}
									>
										<Icon name={link.icon} class='h-4 w-4' />
									</a>
								))
							}
							<span class='text-muted-foreground'>|</span>
							<a
								href='https://fullstackdatascientist.substack.com'
								target='_blank'
								class='group flex items-center gap-2 text-sm'
							>
								<Icon name='simple-icons:substack' class='h-4 w-4 shrink-0' />
								<span class='text-muted-foreground'>Newsletter: Full Stack Data Scientist</span>
								<span class='font-medium text-foreground transition group-hover:translate-x-0.5'>Subscribe →</span>
							</a>
						</div>
					</div>
				</div>
			</section>

			<!-- ============================================ -->
			<!-- PHILOSOPHY                                   -->
			<!-- ============================================ -->
			<section class='mt-10 space-y-4'>
				<h2 class='text-2xl font-bold text-foreground'>Philosophy: The Full Stack Data Scientist</h2>
				<p class='text-base text-muted-foreground'>
					With more than a decade in the data science field, I realized that the best way to learn isn't more notebooks or collecting more courses — it's building end-to-end. I'm building projects that force me to wear every hat: PM, engineer, architect, marketer, and finally the data scientist. 
				</p>
				<p class='text-base text-muted-foreground'>
					You understand data differently when you built the system that created it. And when the insights from your analysis or predictions from your ML model improves the product, the loop starts again. 
				</p>
				<p class='text-base text-muted-foreground'>
					<b>Startup mentality. The Build Loop.</b> AI handles the scaffolding; human does the thinking & planning.
				</p>
				<p class='text-base text-muted-foreground'>
					As a leader, I can't ask my team to embrace new tools and workflows if I haven't experienced the learning curve myself. I build in my personal time—not to replace engineers, but to understand the tradeoffs firsthand. It makes me a better collaborator and a more credible leader.
				</p>
			</section>

			<!-- ============================================ -->
			<!-- PROJECTS                                     -->
			<!-- ============================================ -->
			<section class='mt-10 space-y-4'>
				<h2 class='text-2xl font-bold text-foreground'>Projects</h2>
				<div class='space-y-3'>
					{liveProjects.map((project) => (
						<ProjectCard project={project} variant='compact' />
					))}
				</div>
				
				<!-- What's Next Timeline -->
				<div class='mt-6'>
					<Timeline 
						inProgressProjects={inProgressProjects} 
						upcomingProjects={upcomingProjects} 
					/>
				</div>
			</section>

			<!-- ============================================ -->
			<!-- NEWSLETTER SIGNUP                            -->
			<!-- Opens Substack with email pre-filled         -->
			<!-- ============================================ -->
			<section class='mt-10'>
				<div class='border border-border bg-primary-foreground p-8'>
					<div class='flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between'>
						<div class='flex items-start gap-3'>
							<Icon name='simple-icons:substack' class='h-6 w-6 mt-0.5 shrink-0 text-[#FF6719]' />
							<div class='space-y-1'>
								<h2 class='text-xl font-bold text-foreground'>Full Stack Data Scientist</h2>
								<p class='text-sm text-muted-foreground'>Building data science products end-to-end. New posts delivered free.</p>
							</div>
						</div>
						<form 
							class='flex w-full gap-2 sm:w-auto'
							id="newsletter-form"
							onsubmit="event.preventDefault(); const email = this.email.value; if(email) window.open('https://fullstackdatascientist.substack.com/subscribe?email=' + encodeURIComponent(email), '_blank');"
						>
							<input 
								type="email" 
								name="email" 
								placeholder="you@email.com" 
								required
								class='flex-1 sm:w-64 px-4 py-2.5 text-sm border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20 focus:border-foreground transition-all'
							/>
							<button 
								type="submit" 
								class='shrink-0 px-5 py-2.5 text-sm font-medium bg-foreground text-background hover:bg-foreground/90 transition-all hover:-translate-y-0.5'
							>
								Subscribe
							</button>
						</form>
					</div>
				</div>
			</section>

	</div>
</PageLayout>
