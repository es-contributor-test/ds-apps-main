---
import PageLayout from '../layouts/BaseLayout.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(
	path.join(process.cwd(), 'src/data/social-links.yaml'),
	'utf8'
)
const socialData = yaml.load(socialLinksYaml) as {
	socialLinks: Array<{ name: string; url: string; icon: string; label: string }>
}
const socialLinks = socialData.socialLinks

// Load build log data for stats
import buildLogData from '../../packages/build-log/src/data/build-log-data.json'
const totalContributors = buildLogData.contributors?.length ?? 0
const openTasks = buildLogData.tasks?.filter((t: any) => t.status === 'open').length ?? 0

// Load learnings count
import { parseLearningsYaml } from '../../packages/shared/src/lib/learnings'
import learningsYaml from '../../packages/shared/src/data/learnings.yaml?raw'
const learnings = parseLearningsYaml(learningsYaml)
const learningsCount = learnings.length

// Load projects
import { parseProjectsYaml } from '../../packages/shared/src/lib/projects'
import projectsYaml from '../../packages/shared/src/data/projects.yaml?raw'
import ProjectCard from '../../packages/shared/src/components/ProjectCard.astro'
const projects = parseProjectsYaml(projectsYaml)
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='flex w-full flex-col gap-y-10'>
		
		<!-- ============================================ -->
		<!-- HERO: Compact horizontal card                -->
		<!-- ============================================ -->
		<section class='rounded-2xl border border-border bg-primary-foreground p-6 shadow-lg shadow-black/5'>
			<div class='flex flex-col items-center gap-6 sm:flex-row sm:items-start'>
				<!-- Profile Image -->
				<Image
					src={profile}
					alt='profile photo'
					class='h-28 w-28 shrink-0 rounded-full bg-[#FFBE98] p-1.5'
					loading='eager'
				/>

				<!-- Name + Tagline + Socials -->
				<div class='flex flex-col items-center gap-4 sm:items-start'>
					<div class='text-center sm:text-left'>
						<h1 class='text-2xl font-bold sm:text-3xl'>Eeshan Srivastava</h1>
						<p class='mt-1 max-w-md text-base text-muted-foreground'>
							Data science leader building products with AI and writing about the journey
						</p>
					</div>

					<!-- Social Links -->
					<div class='flex gap-x-3'>
						{
							socialLinks.map((link) => (
								<a
									href={link.url}
									target='_blank'
									class='flex h-9 w-9 items-center justify-center rounded-full border border-border bg-background transition-all hover:bg-input'
									aria-label={link.label}
								>
									<Icon name={link.icon} class='h-4 w-4' />
								</a>
							))
						}
					</div>
				</div>
			</div>
		</section>

		<!-- ============================================ -->
		<!-- THE BUILD LOG: Main showcase                 -->
		<!-- ============================================ -->
		<section class='space-y-4'>
			<h2 class='text-2xl font-bold text-foreground'>The Build Log</h2>
			
			<div class='rounded-2xl border border-border bg-primary-foreground p-5 shadow-lg shadow-black/5'>
				<div class='flex flex-wrap items-start justify-between gap-4'>
					<p class='text-sm text-muted-foreground'>Learning AI-native product development in public — and documenting everything.</p>
					<a
						href='/build-log/'
						class='inline-flex shrink-0 items-center gap-2 rounded-full bg-orange-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-orange-400'
					>
						Explore the Build Log →
					</a>
				</div>

				<!-- Projects subsection -->
				<div class='mt-6'>
					<h3 class='mb-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground'>Projects</h3>
					<div class='space-y-3'>
						{projects.map((project) => (
							<ProjectCard project={project} variant='compact' />
						))}
					</div>
				</div>

				<!-- Learnings subsection -->
				<div class='mt-5'>
					<h3 class='mb-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground'>What I've Learned</h3>
					<a
						href='/build-log/#learnings'
						class='group block rounded-xl border border-border bg-background p-4 transition hover:border-orange-300 hover:shadow-sm'
					>
						<div class='flex items-center justify-between'>
							<div class='flex items-center gap-4'>
								<div>
									<span class='text-2xl font-bold text-foreground'>{learningsCount}</span>
									<span class='ml-1 text-sm text-muted-foreground'>posts</span>
								</div>
								<p class='text-sm text-muted-foreground'>Build logs, technical deep-dives, and lessons from shipping</p>
							</div>
							<span class='text-muted-foreground transition group-hover:translate-x-0.5 group-hover:text-orange-500'>→</span>
						</div>
					</a>
				</div>
			</div>
		</section>

		<!-- ============================================ -->
		<!-- CONTRIBUTE                                   -->
		<!-- ============================================ -->
		<section class='space-y-4'>
			<h2 class='text-2xl font-bold text-foreground'>Contribute</h2>
			
			<div class='rounded-2xl border border-border bg-primary-foreground p-5 shadow-lg shadow-black/5'>
				<div class='flex flex-wrap items-center justify-between gap-4'>
					<div class='space-y-1'>
						<p class='text-sm text-muted-foreground'>Claim a task, open a PR, get code review, and ship. Real projects, real GitHub history.</p>
						<div class='flex items-center gap-4 pt-1 text-sm'>
							<span><span class='font-bold text-foreground'>{totalContributors}</span> <span class='text-muted-foreground'>contributors</span></span>
							<span><span class='font-bold text-orange-500'>{openTasks}</span> <span class='text-muted-foreground'>open tasks</span></span>
						</div>
					</div>
					<a
						href='/build-log/contribute/'
						class='inline-flex shrink-0 items-center gap-2 rounded-full bg-orange-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-orange-400'
					>
						See Open Tasks →
					</a>
				</div>
			</div>
		</section>

		<!-- ============================================ -->
		<!-- NEWSLETTER                                   -->
		<!-- ============================================ -->
		<section class='space-y-4'>
			<h2 class='text-2xl font-bold text-foreground'>Newsletter</h2>
			
			<div class='rounded-2xl border border-border bg-primary-foreground p-5 shadow-lg shadow-black/5'>
				<div class='flex flex-wrap items-center justify-between gap-4'>
					<div class='flex items-center gap-3'>
						<div class='flex-shrink-0 rounded-lg bg-orange-500 p-2'>
							<Icon name='simple-icons:substack' class='h-5 w-5 text-white' />
						</div>
						<div>
							<p class='text-base font-semibold text-foreground'>Science of Experimentation & Analytics</p>
							<p class='text-sm text-muted-foreground'>Subscribe to my newsletter on Substack</p>
						</div>
					</div>
					<a
						href='https://scienceofexperimentation.substack.com'
						target='_blank'
						class='inline-flex shrink-0 items-center gap-2 rounded-full bg-orange-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-orange-400'
					>
						Subscribe →
					</a>
				</div>
			</div>
		</section>

	</div>
</PageLayout>
