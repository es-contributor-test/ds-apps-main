---
import PageLayout from '../layouts/BaseLayout.astro'
import { Icon } from 'astro-icon/components'

import { Image } from 'astro:assets'
import profile from '../assets/profile.jpg'

import fs from 'fs'
import yaml from 'js-yaml'
import path from 'path'

// Load social links
const socialLinksYaml = fs.readFileSync(
	path.join(process.cwd(), 'src/data/social-links.yaml'),
	'utf8'
)
const socialData = yaml.load(socialLinksYaml) as {
	socialLinks: Array<{ name: string; url: string; icon: string; label: string }>
}
const socialLinks = socialData.socialLinks

// Load projects
import { getLiveProjects, getProjectsByStatus } from '../../packages/shared/src/lib/projects'
import { getAllProjects } from '../../packages/shared/src/data/projectLoader'
import ProjectCard from '../../packages/shared/src/components/ProjectCard.astro'
import Timeline from '../../packages/shared/src/components/Timeline.astro'

const allProjects = getAllProjects()
const liveProjects = getLiveProjects(allProjects)
const inProgressProjects = getProjectsByStatus(allProjects, 'in-progress')
const activeProjects = [...liveProjects, ...inProgressProjects] // Cards for live + in-progress
const upcomingProjects = getProjectsByStatus(allProjects, 'coming-soon')
---

<PageLayout meta={{ title: 'Home' }}>
	<div class='w-full'>

		<!-- ============================================ -->
		<!-- HERO: Compact horizontal card                -->
		<!-- ============================================ -->
			<section class='border border-border bg-primary-foreground p-6 shadow-lg shadow-black/5'>
				<div class='flex flex-col items-center gap-6 sm:flex-row sm:items-start'>
					<!-- Profile Image -->
					<Image
						src={profile}
						alt='profile photo'
						class='h-28 w-28 shrink-0 rounded-full bg-[#FFBE98] p-1.5'
						loading='eager'
					/>

					<!-- Name + Tagline + Socials -->
					<div class='flex flex-col items-center gap-4 sm:items-start'>
						<div class='text-center sm:text-left'>
							<h1 class='text-2xl font-bold sm:text-3xl'>Eeshan Srivastava</h1>
							<p class='mt-1 text-lg text-muted-foreground'>
								Engineer × Data Scientist × Business Leader <span class='mx-1 text-border'>|</span> <span class='font-serif italic text-amber-700 dark:text-amber-400'>Building in Public</span>
							</p>
						</div>

						<!-- Social Links + Newsletter -->
						<div class='flex flex-wrap items-center gap-x-3 gap-y-3'>
							{
								socialLinks.map((link) => (
									<a
										href={link.url}
										target='_blank'
										class='flex h-9 w-9 items-center justify-center rounded-full border border-border bg-background transition-all hover:bg-input'
										aria-label={link.label}
									>
										<Icon name={link.icon} class='h-4 w-4' />
									</a>
								))
							}
							<span class='text-muted-foreground'>|</span>
							<a
								href='https://fullstackdatascientist.substack.com'
								target='_blank'
								class='group flex items-center gap-2 text-sm'
							>
								<Icon name='simple-icons:substack' class='h-4 w-4 shrink-0' />
								<span class='text-muted-foreground'>Newsletter: Full Stack Data Scientist</span>
								<span class='font-medium text-foreground transition group-hover:translate-x-0.5'>Subscribe →</span>
							</a>
						</div>
					</div>
				</div>
			</section>

			<!-- ============================================ -->
			<!-- PHILOSOPHY                                   -->
			<!-- ============================================ -->
			<section class='mt-10 space-y-4'>
				<h2 class='text-2xl font-bold text-foreground'>The Full Stack Data Scientist</h2>
				<p class='text-base text-muted-foreground'>
					The era of the notebook-only data scientist is ending. AI can write your Python, run your regressions, and generate your charts. What it can't do is understand why the data looks wrong, debug the pipeline that created it, or explain to the exec team why this model matters.
				</p>
				<p class='text-base text-muted-foreground'>
					The future belongs to data scientists who can <strong>build the product, own the data infrastructure, and translate insights into business decisions</strong>. Not specialists waiting for clean CSVs—generalists who understand the full system.
				</p>
				<p class='text-base text-muted-foreground'>
					This site is my proof of concept. Every project here—from the analytics pipeline to the A/B testing platform—was built end-to-end. AI handles the scaffolding; I do the architecture, the analysis, and the decisions.
				</p>
			</section>

			<!-- ============================================ -->
			<!-- PROJECTS                                     -->
			<!-- ============================================ -->
			<section class='mt-10 space-y-4'>
				<h2 class='text-2xl font-bold text-foreground'>Projects</h2>
				<div class='space-y-3'>
					{activeProjects.map((project) => (
						<ProjectCard project={project} variant='compact' />
					))}
				</div>
				
				<!-- What's Next Timeline (coming-soon only) -->
				{upcomingProjects.length > 0 && (
					<div class='mt-6'>
						<Timeline 
							inProgressProjects={[]} 
							upcomingProjects={upcomingProjects} 
						/>
					</div>
				)}
			</section>

			<!-- ============================================ -->
			<!-- NEWSLETTER SIGNUP                            -->
			<!-- Opens Substack with email pre-filled         -->
			<!-- ============================================ -->
			<section class='mt-10'>
				<div class='border border-border bg-primary-foreground p-8'>
					<div class='flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between'>
						<div class='flex items-start gap-3'>
							<Icon name='simple-icons:substack' class='h-6 w-6 mt-0.5 shrink-0 text-[#FF6719]' />
							<div class='space-y-1'>
								<h2 class='text-xl font-bold text-foreground'>Full Stack Data Scientist</h2>
								<p class='text-sm text-muted-foreground'>Building data science products end-to-end. New posts delivered free.</p>
							</div>
						</div>
						<form 
							class='flex w-full gap-2 sm:w-auto'
							id="newsletter-form"
							onsubmit="event.preventDefault(); const email = this.email.value; if(email) window.open('https://fullstackdatascientist.substack.com/subscribe?email=' + encodeURIComponent(email), '_blank');"
						>
							<input 
								type="email" 
								name="email" 
								placeholder="you@email.com" 
								required
								class='flex-1 sm:w-64 px-4 py-2.5 text-sm border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-foreground/20 focus:border-foreground transition-all'
							/>
							<button 
								type="submit" 
								class='shrink-0 px-5 py-2.5 text-sm font-medium bg-foreground text-background hover:bg-foreground/90 transition-all hover:-translate-y-0.5'
							>
								Subscribe
							</button>
						</form>
					</div>
				</div>
			</section>

	</div>
</PageLayout>
