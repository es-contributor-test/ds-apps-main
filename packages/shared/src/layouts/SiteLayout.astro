---
import '../styles/app.css'
import Header from '../components/layout/Header.astro'
import Footer from '../components/layout/Footer.astro'

interface Props {
	meta: {
		title: string
		description?: string
	}
}

const { meta } = Astro.props
const posthogKey = import.meta.env.PUBLIC_POSTHOG_KEY || ''
const posthogHost = import.meta.env.PUBLIC_POSTHOG_HOST || 'https://api-v2.eeshans.com'

const siteTitle = `${meta.title} â€¢ Eeshan S.`
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{siteTitle}</title>
		{meta.description && <meta name="description" content={meta.description} />}
		
		<!-- Favicon -->
		<link rel='apple-touch-icon' sizes='180x180' href='/shared-assets/favicon/apple-touch-icon.png' />
		<link rel='icon' type='image/png' sizes='32x32' href='/shared-assets/favicon/favicon-32x32.png' />
		<link rel='icon' type='image/png' sizes='16x16' href='/shared-assets/favicon/favicon-16x16.png' />
		<link rel='manifest' href='/shared-assets/favicon/site.webmanifest' />

		<!-- PostHog Analytics -->
		{posthogKey && (
		<script is:inline define:vars={{ posthogKey, posthogHost }}>
		!function(t,e){var o,n,p,r;e.__SV||(window.posthog&&window.posthog.__loaded)||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split('.');2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement('script')).type='text/javascript',p.crossOrigin='anonymous',p.async=!0,p.src=s.api_host+'/static/array.js',(r=t.getElementsByTagName('script')[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a='posthog',u.people=u.people||[],u.toString=function(t){var e='posthog';return'posthog'!==a&&(e+='.'+a),t||(e+=' (stub)'),e},u.people.toString=function(){return u.toString(1)+'.people (stub)'},o='init capture identify alias register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId'.split(' '),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
		posthog.init(posthogKey, {
			api_host: posthogHost,
			ui_host: 'https://us.posthog.com',
			defaults: '2025-05-24',
			person_profiles: 'identified_only',
			loaded: function(posthog_instance) {
				window.__posthogReady = true;
			}
		});
		</script>
		)}

		<!-- Theme Provider (dark mode) -->
		<script is:inline>
			const lightModePref = window.matchMedia('(prefers-color-scheme: light)')

			function getUserPref() {
				const storedTheme = localStorage.getItem('theme') ?? undefined
				return storedTheme || (lightModePref.matches ? 'light' : 'dark')
			}

			function setTheme(newTheme) {
				if (newTheme !== 'light' && newTheme !== 'dark') {
					return console.log(`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`)
				}

				localStorage.setItem('theme', newTheme)

				const root = document.documentElement

				if (newTheme === 'dark' && root.classList.contains('dark')) {
					return
				} else if (newTheme === 'light' && !root.classList.contains('dark')) {
					return
				}

				root.classList.toggle('dark')
			}

			setTheme(getUserPref())

			document.addEventListener('astro:after-swap', () => setTheme(getUserPref()))
			document.addEventListener('theme-change', (e) => setTheme(e.detail.theme))
			lightModePref.addEventListener('change', (e) => setTheme(e.matches ? 'light' : 'dark'))
		</script>
	</head>
	<body class='flex justify-center bg-background'>
		<main
			class='flex min-h-screen w-screen max-w-[60rem] flex-col items-center px-6 pb-10 pt-7 font-sans text-[0.92rem] leading-relaxed sm:px-10 lg:px-10'
		>
			<Header />
			<slot />
			<Footer />
		</main>
	</body>
</html>
